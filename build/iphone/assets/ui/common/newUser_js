function newUser(e){var t=Ti.UI.create2DMatrix();t=t.scale(0),Ti.App.msisdn="",Ti.App.network="";var a=Ti.UI.createWindow({backgroundColor:"#336699",borderWidth:8,borderColor:"#999",height:"89%",width:"93%",borderRadius:10,opacity:.93,transform:t}),r=Ti.UI.createLabel({text:"Swipe down when done",visible:!1,color:"white"}),i=Ti.UI.create2DMatrix();i=i.scale(1.1);var n=Ti.UI.createAnimation();n.transform=i,n.duration=200,n.addEventListener("complete",function(){Ti.API.info("Register Window");var e=Ti.UI.create2DMatrix();e=e.scale(1),a.animate({transform:e,duration:200})});var o=Ti.UI.createButton({title:"Register",height:"7%",width:"50%",bottom:"8%"});a.add(o);var s=Ti.UI.createTextField({height:"7%",bottom:"30%",color:"black",hintText:"Network: ",left:"10%",right:"10%",font:{fontSize:"19pt",fontWeight:"bold"},textAlign:"TEXT_ALIGNMENT_CENTER",backgroundColor:"#E3E8E8",editable:!1});a.add(s);var l=Ti.UI.createTextField({height:"7%",bottom:"20%",color:"black",hintText:"Phone number: ",left:"10%",right:"10%",font:{fontSize:"19pt",fontWeight:"bold"},textAlign:"TEXT_ALIGNMENT_CENTER",backgroundColor:"#E3E8E8"});l.keyboardType=Ti.UI.KEYBOARD_PHONE_PAD,a.add(l),o.addEventListener("click",function(){if(Ti.App.msisdn=l.getValue(),(""==Ti.App.network||""==Ti.App.msisdn)&&(0==Ti.App.network.length&&""==Ti.App.msisdn?alert("No phone number or network selected"):0==Ti.App.network.length?alert("No network selected"):""==Ti.App.msisdn&&alert("No phone number entered")),Ti.App.network.length>0&&Ti.App.msisdn.length>0&&Ti.App.country.length>0&&Ti.App.url.length>0){var t=Ti.Database.open("local"),r=t.execute("SELECT msisdn FROM data WHERE msisdn ="+Ti.App.msisdn);for(0==r.isValidRow()?(r=t.execute("INSERT INTO data (msisdn, url, country, site_name) VALUES (?, ?, ?, ?)",Ti.App.msisdn,Ti.App.url,Ti.App.country,Ti.App.network),t.execute("INSERT INTO user_language (msisdn, lang_code, lang_name) VALUES(?,?,?)",Ti.App.msisdn,e[0].language[0].code,e[0].language[0].name)):(r=t.execute("UPDATE data SET url = ?, country = ?, site_name = ? WHERE msisdn = ?",Ti.App.url,Ti.App.country,Ti.App.network,Ti.App.msisdn),t.execute("UPDATE user_language SET lang_code = ?, lang_name = ? WHERE msisdn = ?",e[0].language[0].code,e[0].language[0].name,Ti.App.msisdn)),r=t.execute("SELECT * FROM data"),Ti.API.info("Database");r.isValidRow();){var i=r.fieldByName("msisdn"),n=r.fieldByName("site_name");Ti.API.info("Number: "+i+" Site Name: "+n),r.next()}t.close(),vasxRegisterUser(Ti.App.msisdn,Ti.App.language,1)}var o=Ti.UI.create2DMatrix();o=o.scale(0),a.close({transform:o,duration:300})});for(var c=Ti.UI.createView({backgroundColor:"transparent",left:"3%",right:"3%",borderRadius:10,top:"3%",bottom:"40%",borderColor:"white",borderSize:2}),d=[],h=0;e.length>h;h++){var u=Ti.UI.createTableViewRow({selectedBackgroundColor:"transparent",height:40,country:e[h].country,network:e[h].network,url:e[h].url,language:e[h].language,vnUID:e[h].vnUID});textLabel=Ti.UI.createLabel({text:e[h].country+" - "+e[h].network,color:"white",font:{fontSize:"16pt",fontWeight:"bold"},left:0}),u.add(textLabel);var p,g=Ti.Filesystem.applicationDataDirectory;p=Ti.Filesystem.getFile(g,e[h].country+"Flag.png")?"/images/flags/"+e[h].country+"Flag.png":"/images/flags/saFlag.png";var m=Ti.UI.createImageView({image:p,right:"1.5%",height:"70%",width:"17%"});u.add(m),d.push(u)}var f=Ti.UI.createTableView({data:d,backgroundColor:"transparent",allowSelection:!0});f.addEventListener("click",function(e){s.setValue(e.rowData.network+", "+e.rowData.country),l.blur(),s.blur(),Ti.App.network=e.rowData.network,Ti.App.url=e.rowData.url,Ti.App.country=e.rowData.country;for(var t=0;e.rowData.language.length>t;t++)Ti.Locale.getCurrentLanguage()==e.rowData.language[t].code&&(Ti.App.language=e.rowData.language[t].code);""==Ti.App.Language&&(Ti.App.language=e.rowData.language[0].code),Ti.API.info("Country: "+e.rowData.country),Ti.API.info("Site Name: "+e.rowData.network),Ti.API.info("Site URL: "+e.rowData.url),Ti.API.info("vnUID: "+e.rowData.vnUID),Ti.API.info("Phones Language: "+Ti.Locale.getCurrentLanguage());for(var a=0;e.rowData.language.length>a;a++)Ti.API.info("Language Available: "+e.rowData.language[a].name);Ti.API.info("Default Language: "+e.rowData.language[0].name)}),l.addEventListener("focus",function(){this.setBottom("80%"),f.hide(),r.setVisible(!0)}),s.addEventListener("focus",function(){this.setBottom("80%"),f.hide()}),l.addEventListener("blur",function(){this.setBottom("20%"),f.show(),r.setVisible(!1)}),s.addEventListener("blur",function(){this.setBottom("30%"),f.show()}),c.add(f),a.add(c),c.add(r),a.addEventListener("swipe",function(e){"down"==e.direction&&(l.blur(),s.blur())}),a.open(n)}exports.newUser=newUser;