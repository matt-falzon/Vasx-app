function login(){function e(e,t,a){var r=Ti.Network.createHTTPClient(),i=[{MSISDN:e,LanguageCode:t,Password:a,VirtualNetwork:1}],n=generateXML("http://service.adminportal.vasx.com/","authenticateUser",i);r.open("POST","http://192.168.20.3:12080/vx_adminportal/AdminPortal"),r.setRequestHeader("Content-Type","text/xml"),r.setRequestHeader("Content-Length",n.length),r.setRequestHeader("SOAPAction",'"authenticateUser"'),r.send(n),r.onload=function(){var e=r.responseXML.documentElement.getElementsByTagName("authenticateUserResponse");Ti.API.info(e.item(0).text);var a=Ti.XML.parseString(e.item(0).text),i=a.getElementsByTagName("Message"),n=a.getElementsByTagName("SessionID"),o=a.getElementsByTagName("Code");a.getElementsByTagName("PasswordExpired"),a.getElementsByTagName("MasterUser");var s=a.getElementsByTagName("FirstName"),l=a.getElementsByTagName("LastName"),c=a.getElementsByTagName("AvailableSMS");if("AP-Success"==o.item(0).text){"images/common/checkbox-checked.png"==w.getBackgroundImage()?(p.valueData=y.getValue(),g.valueData=b.getValue()):(p.valueData="",g.valueData="");var d=require("ui/common/ui");setTimeout(function(){u.closeIndicator()},3e3),d.createMainWindow(n.item(0).text,s.item(0).text,l.item(0).text,c.item(0).text,t,y.getValue())}else alert(i.item(0).text),u.closeIndicator()}}function t(){var e=Ti.Network.createHTTPClient();e.onerror=function(){Ti.API.error(this.status+" - "+this.statusText)};var t,a=generateXML("http://ws.proxy.mobile.vasx.com/","getNetworkInformation",t);e.open("POST","http://192.168.20.3:12080/mobile-proxy/MobileProxyService"),e.setRequestHeader("Content-Type","text/xml"),e.setRequestHeader("Content-Length",a.length),e.setRequestHeader("SOAPAction",'"getNetworkInformation"'),e.send(a),e.onload=function(){var t=e.responseXML.documentElement.getElementsByTagName("getNetworkInformationResponse"),a=[],r=[];if(t&&t.length>0){var i=Ti.XML.parseString(t.item(0).text),n=i.getElementsByTagName("Country"),o=i.getElementsByTagName("SiteName"),s=i.getElementsByTagName("SiteURL"),l=i.getElementsByTagName("Languages"),c=i.getElementsByTagName("vnUID");i.getElementsByTagName("Name"),i.getElementsByTagName("Code"),i.getElementsByTagName("Default");for(var d=0;n.length>d;d++){for(var h=0;l.item(d).getElementsByTagName("Name").length>h;h++){var p=l.item(d).getElementsByTagName("Name").item(h).text,g=l.item(d).getElementsByTagName("Code").item(h).text,m=l.item(d).getElementsByTagName("Default").item(h).text;a.push({name:p,code:g,def:m})}r.push({country:n.item(d).text,network:o.item(d).text,url:s.item(d).text,language:a,vnUID:c.item(d).text}),a=[]}var f=require("ui/common/register");f.registerWindow(r),u.closeIndicator()}else{r.push({country:"Network ERROR",network:"",url:""});var f=require("ui/common/register");u.closeIndicator(),f.registerWindow(r)}}}function a(){y.value.length>0&&b.value.length>0&&w.setBackgroundImage("images/common/checkbox-checked.png")}Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/webService.js");var r=require("com.obscure.keychain");Ti.Database.install("local.db","local");var i=Ti.UI.createView();Ti.App.msisdn,Ti.App.network,Ti.App.url,Ti.App.country,Ti.App.language,getVersion();var n,o,s,l,c,d=Ti.Locale.getCurrentLanguage(),h=require("libs/IndicatorWindow"),u=h.createIndicatorWindow();"pt"==d?(n="número de telefone",o="senha",s="salvar minhas credenciais",l="17%",c="80%",y.setHintText("nome de usuário"),b.setHintText("senha")):"fr"==d?(n="numéro de téléphone",o="passe",s="sauver mes lettres de créance",l="10%",c="83%",y.setHintText("Nom d'utilisateur"),b.setHintText("Passe")):(n="Phone number",o="Password",s="Save my credentials",l="22%",c="74%");var p=r.createKeychainItem("msisdn"),g=r.createKeychainItem("password"),m=Ti.UI.createImageView({image:"images/common/banner.png",top:"11%",height:"20%",width:"60%"});Ti.Database.install("local.db","local");var f=Ti.Database.open("local");f.execute("CREATE TABLE IF NOT EXISTS data(msisdn VARCHAR PRIMARY KEY NOT NULL, url VARCHAR NOT NULL, country VARCHAR NOT NULL, site_name VARCHAR NOT NULL, account_type VARCHAR, lang_code VARCHAR, lang_name VARCHAR)"),f.execute("CREATE TABLE IF NOT EXISTS friendly_names(uid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, contact_id INTEGER NOT NULL, msisdn VARCHAR, user_msisdn VARCHAR)"),f.execute("CREATE TABLE IF NOT EXISTS user_language(uid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, msisdn VARCHAR, lang_code VARCHAR, lang_name VARCHAR)");for(var v=f.execute("SELECT * FROM user_language");v.isValidRow();)Ti.API.info("msisdn: "+v.fieldByName("msisdn")+" lang: "+v.fieldByName("lang_code")),v.next();f.close();var T=Ti.UI.createLabel({text:"Forgot password",color:"teal",font:{fontSize:"12sp"},top:"93%"}),y=Ti.UI.createTextField({hintText:n,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,color:"#336699",top:"44%",width:"50%",height:"7%",autocapitalization:0,autocorrect:!1,value:p.valueData}),b=Ti.UI.createTextField({hintText:o,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,color:"#336699",top:"54%",width:"50%",height:"7%",passwordMask:!0,value:g.valueData}),w=Ti.UI.createView({backgroundImage:"images/common/checkbox.png",width:20,height:20,top:"75%",left:c}),x=Ti.UI.createLabel({text:s,top:"74.5%",left:l,height:"5%"}),_=Ti.UI.createImageView({image:"images/common/loginButton.png",top:"63%",width:"50%",height:"8%"}),C=Ti.UI.createImageView({image:"images/common/registerButton.png",top:"85%",width:"50%",height:"8%"});return a(),i.add(y),i.add(b),i.add(_),i.add(m),i.add(C),i.add(w),i.add(x),i.add(T),_.addEventListener("click",function(){u.openIndicator();var t=Ti.Database.open("local"),a=t.execute("SELECT lang_name, lang_code FROM user_language where msisdn = ?",y.getValue());if(a.isValidRow()){var r=a.fieldByName("lang_code");t.close(),Ti.API.info("saved lang: "+r)}else var r="";r.length>0?("au"==r&&(r="en"),e(""+y.value,r,""+b.value,1)):e(""+y.value,"en",""+b.value,1)}),C.addEventListener("click",function(){t()}),m.addEventListener("click",function(){y.blur(),b.blur()}),x.addEventListener("click",function(){"images/common/checkbox.png"==w.getBackgroundImage()?w.setBackgroundImage("images/common/checkbox-checked.png"):w.setBackgroundImage("images/common/checkbox.png")}),w.addEventListener("click",function(){"images/common/checkbox.png"==w.getBackgroundImage()?w.setBackgroundImage("images/common/checkbox-checked.png"):w.setBackgroundImage("images/common/checkbox.png")}),y.addEventListener("click",function(){y.blur(),b.blur(),y.keyboardType=Ti.UI.KEYBOARD_PHONE_PAD,y.focus()}),T.addEventListener("click",function(){var e=require("ui/common/forgotPassword");e.forgotPassword()}),i.addEventListener("swipe",function(e){"down"==e.direction?y.blur():"up"==e.direction&&y.focus()}),i}module.exports=login;