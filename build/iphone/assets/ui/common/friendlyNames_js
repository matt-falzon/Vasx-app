function orderNames(){var e=Ti.Contacts.getAllGroups(),t=e[0].members();Ti.API.info(t);var a=Ti.Contacts.getAllPeople();for(var r in a)e[0].add(a[r]),Ti.API.info(a[r].firstName),Ti.Contacts.save();e[0].sortedMembers(Ti.Contacts.CONTACTS_SORT_FIRST_NAME),t=e[0].members();for(var r in t)Ti.API.info(t[r].firstName)}function checkNames(){activityIndicator.setVisible(!0);for(var e=Ti.Database.open("local"),t=e.execute("SELECT * FROM friendly_names WHERE user_msisdn =?",Ti.App.msisdn);t.isValidRow();){var a=t.fieldByName("msisdn"),r=t.fieldByName("contact_id");Ti.API.info("Number: "+a+" contact id: "+r),t.next(),tickedArray.push(r)}Ti.API.info("----------");for(var i=0;tickedArray.length>i;i++)for(var n=0;table.data[0].rows.length>n;n++)tickedArray[i]==table.data[0].rows[n].id&&5>Ti.App.checks&&(Ti.API.info("MSISDN "+table.data[0].rows[n].msisdn+": Ticked"),table.data[0].rows[n].hasCheck=!0,Ti.App.checks++,n=table.data[0].rows.length-1);Ti.API.info("Total checks: "+Ti.App.checks),e.close(),x=0,win.add(mainView),mainView.add(table),activityIndicator.setColor(Ti.App.backgroundColor),activityIndicator.setIndicatorColor(Ti.App.backgroundColor),activityIndicator.setWidth(0),activityIndicator.setHeight(0),activityIndicator.hide()}var win=Ti.UI.currentWindow;Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/commonFunctions.js"),theme("red"),win.backgroundColor=Ti.App.backgroundColor,Ti.App.msisdn=win.msisdn,Ti.API.info(Ti.App.msisdn);var tickedArray=[],theContacts=[],x=1,style;style="iPhone OS"===Ti.Platform.name?Ti.UI.iPhone.ActivityIndicatorStyle.DARK:Ti.UI.ActivityIndicatorStyle.DARK;var activityIndicator=Ti.UI.createActivityIndicator({color:"green",font:{fontFamily:"Helvetica Neue",fontSize:26,fontWeight:"bold"},message:"Loading...",style:style,top:10,left:10,height:"20%",width:"50%",visible:!1}),performAddressBookFunction=function(){theContacts=getContacts()},addressBookDisallowed=function(){alert("This app requires access to your phone book")};Ti.Contacts.contactsAuthorization==Ti.Contacts.AUTHORIZATION_AUTHORIZED?performAddressBookFunction():Ti.Contacts.contactsAuthorization==Ti.Contacts.AUTHORIZATION_UNKNOWN?Ti.Contacts.requestAuthorization(function(e){e.success?performAddressBookFunction():addressBookDisallowed()}):addressBookDisallowed();var button=Ti.UI.createButton({title:"press me",left:10}),table=Ti.UI.createTableView({data:theContacts,backgroundColor:Ti.App.foregroundColor,separatorColor:Ti.App.backgroundColor,editable:!0});win.addEventListener("focus",function(){activityIndicator.setVisible(!0)}),table.addEventListener("click",function(e){e.index,e.section;var t=e.row;e.rowData;var a=Ti.Database.open("local");t.hasCheck===!0?(t.hasCheck=!1,Ti.App.checks--,Ti.API.info(Ti.App.checks),rows=a.execute("DELETE FROM friendly_names WHERE contact_id =?",e.rowData.id),Ti.API.info("DELETED contact ID: "+e.rowData.id+" msisdn: "+e.rowData.msisdn+" Your number is: "+Ti.App.msisdn)):5>Ti.App.checks?(t.hasCheck=!0,Ti.API.info(e.rowData.msisdn),Ti.App.checks++,Ti.API.info(Ti.App.checks),rows=a.execute("INSERT INTO friendly_names (contact_id, msisdn, user_msisdn) VALUES (?, ?, ?)",e.rowData.id,e.rowData.msisdn,Ti.App.msisdn),Ti.API.info("Inserted contact ID: "+e.rowData.id+" msisdn: "+e.rowData.msisdn+" Your number is: "+Ti.App.msisdn)):alert("You may only have up to 5 friends selected"),a.close()});var mainView=Ti.UI.createView({backgroundColor:Ti.App.foregroundColor,top:"3%",bottom:"3%",left:"3%",right:"3%",borderRadius:10});win.add(activityIndicator),checkNames();