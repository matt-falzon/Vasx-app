function login(){function t(t,e,a){var r=Ti.Network.createHTTPClient();Ti.App.Language=e;var n=[{MSISDN:t,LanguageCode:e,Password:a,VirtualNetwork:1}],i=generateXML("http://service.adminportal.vasx.com/","authenticateUser",n);r.open("POST","http://192.168.20.3:12080/vx_adminportal/AdminPortal"),r.setRequestHeader("Content-Type","text/xml"),r.setRequestHeader("Content-Length",i.length),r.setRequestHeader("SOAPAction",'"authenticateUser"'),r.send(i),r.onload=function(){var t=r.responseXML.documentElement.getElementsByTagName("authenticateUserResponse");Ti.API.info(t.item(0).text);var a=Ti.XML.parseString(t.item(0).text),n=a.getElementsByTagName("Message"),i=a.getElementsByTagName("SessionID"),o=a.getElementsByTagName("Code");a.getElementsByTagName("PasswordExpired"),a.getElementsByTagName("MasterUser");var s=a.getElementsByTagName("FirstName"),c=a.getElementsByTagName("LastName"),l=a.getElementsByTagName("AvailableSMS");if("AP-Success"==o.item(0).text){"images/common/checkbox-checked.png"==y.getBackgroundImage()?(msisdnKeychainItem.valueData=m.getValue(),passwordKeychainItem.valueData=v.getValue()):(msisdnKeychainItem.valueData="",passwordKeychainItem.valueData=""),require("ui/common/ui"),setTimeout(function(){u.closeIndicator(),Ti.App.mainWin.setOpacity(1)},1500);var h=require("ui/iphone/main");h.main(i.item(0).text,m.getValue(),l.item(0).text,s.item(0).text,c.item(0).text,e)}else alert(n.item(0).text),u.closeIndicator()}}function e(){var t=Ti.Network.createHTTPClient();t.onerror=function(){Ti.API.error(this.status+" - "+this.statusText)};var e,a=generateXML("http://ws.proxy.mobile.vasx.com/","getNetworkInformation",e);t.open("POST","http://192.168.20.3:12080/mobile-proxy/MobileProxyService"),t.setRequestHeader("Content-Type","text/xml"),t.setRequestHeader("Content-Length",a.length),t.setRequestHeader("SOAPAction",'"getNetworkInformation"'),t.send(a),t.onload=function(){var e=t.responseXML.documentElement.getElementsByTagName("getNetworkInformationResponse"),a=[],r=[];if(e&&e.length>0){var n=Ti.XML.parseString(e.item(0).text),i=n.getElementsByTagName("Country"),o=n.getElementsByTagName("SiteName"),s=n.getElementsByTagName("SiteURL"),c=n.getElementsByTagName("Languages"),l=n.getElementsByTagName("vnUID");n.getElementsByTagName("Name"),n.getElementsByTagName("Code"),n.getElementsByTagName("Default");for(var h=0;i.length>h;h++){for(var d=0;c.item(h).getElementsByTagName("Name").length>d;d++){var p=c.item(h).getElementsByTagName("Name").item(d).text,f=c.item(h).getElementsByTagName("Code").item(d).text,g=c.item(h).getElementsByTagName("Default").item(d).text;a.push({name:p,code:f,def:g})}r.push({country:i.item(h).text,network:o.item(h).text,url:s.item(h).text,language:a,vnUID:l.item(h).text}),a=[]}var m=require("ui/common/register");m.registerWindow(r),u.closeIndicator()}else{r.push({country:"Network ERROR",network:"",url:""});var m=require("ui/common/register");u.closeIndicator(),m.registerWindow(r)}}}function a(){m.value.length>0&&v.value.length>0&&y.setBackgroundImage("images/common/checkbox-checked.png")}Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/webService.js"),Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/commonFunctions.js"),Ti.Database.install("local.db","local");var r=Ti.UI.createView();Ti.App.msisdn,Ti.App.network,Ti.App.url,Ti.App.country,Ti.App.language,getVersion();var n,i,o,s,c,l=Ti.Locale.getCurrentLanguage(),h=require("libs/IndicatorWindow"),u=h.createIndicatorWindow();"pt"==l?(n="número de telefone",i="senha",o="salvar minhas credenciais",s="17%",c="80%",m.setHintText("nome de usuário"),v.setHintText("senha")):"fr"==l?(n="numéro de téléphone",i="passe",o="sauver mes lettres de créance",s="10%",c="83%",m.setHintText("Nom d'utilisateur"),v.setHintText("Passe")):(n="Phone number",i="Password",o="Save my credentials",s="22%",c="74%");var d=Ti.UI.createImageView({image:"images/common/banner.png",top:"11%",height:"20%",width:"60%"});Ti.Database.install("local.db","local");var p=Ti.Database.open("local");p.execute("CREATE TABLE IF NOT EXISTS data(msisdn VARCHAR PRIMARY KEY NOT NULL, url VARCHAR NOT NULL, country VARCHAR NOT NULL, site_name VARCHAR NOT NULL, account_type VARCHAR, lang_code VARCHAR, lang_name VARCHAR)"),p.execute("CREATE TABLE IF NOT EXISTS friendly_names(uid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, contact_id INTEGER NOT NULL, msisdn VARCHAR, user_msisdn VARCHAR)"),p.execute("CREATE TABLE IF NOT EXISTS user_language(uid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, msisdn VARCHAR, lang_code VARCHAR, lang_name VARCHAR)");for(var f=p.execute("SELECT * FROM user_language");f.isValidRow();)Ti.API.info("msisdn: "+f.fieldByName("msisdn")+" lang: "+f.fieldByName("lang_code")),f.next();p.close();var g=Ti.UI.createLabel({text:"Forgot password",color:"teal",font:{fontSize:"12sp"},top:"93%"}),m=Ti.UI.createTextField({hintText:n,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,color:"#336699",top:"44%",width:"50%",height:"7%",autocapitalization:0,autocorrect:!1}),v=Ti.UI.createTextField({hintText:i,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,color:"#336699",top:"54%",width:"50%",height:"7%",passwordMask:!0}),y=Ti.UI.createView({backgroundImage:"images/common/checkbox.png",width:20,height:20,top:"75%",left:c}),b=Ti.UI.createLabel({text:o,top:"74.5%",left:s,height:"5%"}),_=Ti.UI.createImageView({image:"images/common/loginButton.png",top:"63%",width:"50%",height:"8%"}),T=Ti.UI.createImageView({image:"images/common/registerButton.png",top:"85%",width:"50%",height:"8%"});return a(),r.add(m),r.add(v),r.add(_),r.add(d),r.add(T),r.add(y),r.add(b),r.add(g),_.addEventListener("click",function(){u.openIndicator();var e=Ti.Database.open("local"),a=e.execute("SELECT country, site_name, url FROM data where msisdn = ?",m.getValue());if(a.isValidRow()){var r=e.execute("SELECT lang_name, lang_code FROM user_language where msisdn = ?",m.getValue());if(r.isValidRow()){var n=r.fieldByName("lang_code");e.close(),Ti.API.info("saved lang: "+n)}else var n="";n.length>0?("au"==n&&(n="en"),t(""+m.value,n,""+v.value,1)):t(""+m.value,"en",""+v.value,1)}else if("test"==m.getValue(),"pass"==v.getValue()){require("ui/common/ui"),setTimeout(function(){u.closeIndicator(),Ti.App.mainWin.setOpacity(1)},1500);var i=require("ui/iphone/main");i.main("test",m.getValue(),"5","test","user","en")}else newUser(m.getValue()),u.closeIndicator()}),T.addEventListener("click",function(){e()}),d.addEventListener("click",function(){m.blur(),v.blur()}),b.addEventListener("click",function(){"images/common/checkbox.png"==y.getBackgroundImage()?y.setBackgroundImagee("images/common/checkbox-checked.png"):y.setBackgroundImage("images/common/checkbox.png")}),y.addEventListener("click",function(){"images/common/checkbox.png"==y.getBackgroundImage()?y.setBackgroundImage("images/common/checkbox-checked.png"):y.setBackgroundImage("images/common/checkbox.png")}),m.addEventListener("click",function(){m.keyboardType=Ti.UI.KEYBOARD_PHONE_PAD,m.focus(),r.setTop("-30%")}),m.addEventListener("blur",function(){m.blur(),v.blur(),r.setTop("0%")}),v.addEventListener("click",function(){v.focus(),r.setTop("-30%")}),v.addEventListener("blur",function(){m.blur(),v.blur(),r.setTop("0%")}),g.addEventListener("click",function(){var t=require("ui/common/forgotPassword");t.forgotPassword()}),r}module.exports=login;