function open(){function t(){c.setVisible(!0);for(var t=Ti.Database.open("local"),e=t.execute("SELECT * FROM friendly_names WHERE user_msisdn =?",Ti.App.msisdn);e.isValidRow();){var a=e.fieldByName("msisdn"),n=e.fieldByName("contact_id");Ti.API.info("Number: "+a+" contact id: "+n),e.next(),i.push(n)}Ti.API.info("----------");for(var o=0;i.length>o;o++)for(var l=0;u.data[0].rows.length>l;l++)i[o]==u.data[0].rows[l].id&&5>Ti.App.checks&&(Ti.API.info("MSISDN "+u.data[0].rows[l].msisdn+": Ticked"),u.data[0].rows[l].hasCheck=!0,Ti.App.checks++,l=u.data[0].rows.length-1);Ti.API.info("Total checks: "+Ti.App.checks),t.close(),s=0,r.add(d),d.add(u),c.setColor(Ti.App.backgroundColor),c.setIndicatorColor(Ti.App.backgroundColor),c.setWidth(0),c.setHeight(0),c.hide(),phoneSwipeWindow(r),closeMenu(r)}function e(){r.open()}function a(){r.close()}var r=Ti.UI.createWindow({backgroundColor:"pink",left:"51%"});Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/commonFunctions.js"),theme("red"),r.backgroundColor=Ti.App.backgroundColor,Ti.API.info(Ti.App.msisdn);var n,i=[],o=[],s=1;n="iPhone OS"===Ti.Platform.name?Ti.UI.iPhone.ActivityIndicatorStyle.DARK:Ti.UI.ActivityIndicatorStyle.DARK;var c=Ti.UI.createActivityIndicator({color:"green",font:{fontFamily:"Helvetica Neue",fontSize:26,fontWeight:"bold"},message:"Loading...",style:n,top:10,left:10,height:"20%",width:"50%",visible:!1}),l=function(){o=getContacts()},h=function(){alert("This app requires access to your phone book")};Ti.Contacts.contactsAuthorization==Ti.Contacts.AUTHORIZATION_AUTHORIZED?l():Ti.Contacts.contactsAuthorization==Ti.Contacts.AUTHORIZATION_UNKNOWN?Ti.Contacts.requestAuthorization(function(t){t.success?l():h()}):h(),Ti.UI.createButton({title:"press me",left:10});var u=Ti.UI.createTableView({data:o,backgroundColor:Ti.App.foregroundColor,separatorColor:Ti.App.backgroundColor,editable:!1});r.addEventListener("focus",function(){c.setVisible(!0)}),u.addEventListener("click",function(t){t.index,t.section;var e=t.row;t.rowData;var a=Ti.Database.open("local");e.hasCheck===!0?(e.hasCheck=!1,Ti.App.checks--,Ti.API.info(Ti.App.checks),rows=a.execute("DELETE FROM friendly_names WHERE contact_id =?",t.rowData.id),Ti.API.info("DELETED contact ID: "+t.rowData.id+" msisdn: "+t.rowData.msisdn+" Your number is: "+Ti.App.msisdn)):5>Ti.App.checks?(e.hasCheck=!0,Ti.API.info(t.rowData.msisdn),Ti.App.checks++,Ti.API.info(Ti.App.checks),rows=a.execute("INSERT INTO friendly_names (contact_id, msisdn, user_msisdn) VALUES (?, ?, ?)",t.rowData.id,t.rowData.msisdn,Ti.App.msisdn),Ti.API.info("Inserted contact ID: "+t.rowData.id+" msisdn: "+t.rowData.msisdn+" Your number is: "+Ti.App.msisdn)):alert("You may only have up to 5 friends selected"),a.close()});var d=Ti.UI.createView({backgroundColor:Ti.App.foregroundColor,top:"3%",bottom:"3%",left:"3%",right:"3%",borderRadius:10});return r.add(c),t(),r.openWin=e,r.close=a,r}exports.open=open;