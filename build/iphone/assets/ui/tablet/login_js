function login(){function e(e,t,a){var r=Ti.Network.createHTTPClient();Ti.App.Language=t;var i=[{MSISDN:e,LanguageCode:t,Password:a,VirtualNetwork:1}],o=generateXML("http://service.adminportal.vasx.com/","authenticateUser",i);r.open("POST","http://192.168.20.3:12080/vx_adminportal/AdminPortal"),r.setRequestHeader("Content-Type","text/xml"),r.setRequestHeader("Content-Length",o.length),r.setRequestHeader("SOAPAction",'"authenticateUser"'),r.send(o),r.onload=function(){var e=r.responseXML.documentElement.getElementsByTagName("authenticateUserResponse");Ti.API.info(e.item(0).text);var a=Ti.XML.parseString(e.item(0).text),i=a.getElementsByTagName("Message"),o=a.getElementsByTagName("SessionID"),n=a.getElementsByTagName("Code");a.getElementsByTagName("PasswordExpired"),a.getElementsByTagName("MasterUser");var s=a.getElementsByTagName("FirstName"),l=a.getElementsByTagName("LastName"),c=a.getElementsByTagName("AvailableSMS");if("AP-Success"==n.item(0).text){"images/common/checkbox-checked.png"==w.getBackgroundImage()?(p.valueData=b.getValue(),g.valueData=y.getValue()):(p.valueData="",g.valueData=""),require("ui/common/ui"),setTimeout(function(){h.closeIndicator(),Ti.App.mainWin.setOpacity(1)},1500);var d=require("ui/tablet/main");d.main(o.item(0).text,b.getValue(),c.item(0).text,s.item(0).text,l.item(0).text,t)}else alert(i.item(0).text),h.closeIndicator()}}function t(){var e=Ti.Network.createHTTPClient();e.onerror=function(){Ti.API.error(this.status+" - "+this.statusText)};var t,a=generateXML("http://ws.proxy.mobile.vasx.com/","getNetworkInformation",t);e.open("POST","http://192.168.20.3:12080/mobile-proxy/MobileProxyService"),e.setRequestHeader("Content-Type","text/xml"),e.setRequestHeader("Content-Length",a.length),e.setRequestHeader("SOAPAction",'"getNetworkInformation"'),e.send(a),e.onload=function(){var t=e.responseXML.documentElement.getElementsByTagName("getNetworkInformationResponse"),a=[],r=[];if(t&&t.length>0){var i=Ti.XML.parseString(t.item(0).text),o=i.getElementsByTagName("Country"),n=i.getElementsByTagName("SiteName"),s=i.getElementsByTagName("SiteURL"),l=i.getElementsByTagName("Languages"),c=i.getElementsByTagName("vnUID");i.getElementsByTagName("Name"),i.getElementsByTagName("Code"),i.getElementsByTagName("Default");for(var d=0;o.length>d;d++){for(var u=0;l.item(d).getElementsByTagName("Name").length>u;u++){var p=l.item(d).getElementsByTagName("Name").item(u).text,g=l.item(d).getElementsByTagName("Code").item(u).text,m=l.item(d).getElementsByTagName("Default").item(u).text;a.push({name:p,code:g,def:m})}r.push({country:o.item(d).text,network:n.item(d).text,url:s.item(d).text,language:a,vnUID:c.item(d).text}),a=[]}var f=require("ui/common/register");f.registerWindow(r),h.closeIndicator()}else{r.push({country:"Network ERROR",network:"",url:""});var f=require("ui/common/register");h.closeIndicator(),f.registerWindow(r)}}}function a(){b.value.length>0&&y.value.length>0&&w.setBackgroundImage("images/common/checkbox-checked.png")}Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/webService.js"),Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/commonFunctions.js");var r=require("com.obscure.keychain");Ti.Database.install("local.db","local");var i=Ti.UI.createView();Ti.App.msisdn,Ti.App.network,Ti.App.url,Ti.App.country,Ti.App.language,getVersion();var o,n,s,l,c,d=Ti.Locale.getCurrentLanguage(),u=require("libs/IndicatorWindow"),h=u.createIndicatorWindow();"pt"==d?(o="número de telefone",n="senha",s="salvar minhas credenciais",l="17%",c="80%",b.setHintText("nome de usuário"),y.setHintText("senha")):"fr"==d?(o="numéro de téléphone",n="passe",s="sauver mes lettres de créance",l="10%",c="83%",b.setHintText("Nom d'utilisateur"),y.setHintText("Passe")):(o="Phone number",n="Password",s="Save my credentials",l="35%",c="62%");var p=r.createKeychainItem("msisdn"),g=r.createKeychainItem("password"),m=Ti.UI.createImageView({image:"images/common/banner.png",top:"11%",height:"20%",width:"60%"});Ti.Database.install("local.db","local");var f=Ti.Database.open("local");f.execute("CREATE TABLE IF NOT EXISTS data(msisdn VARCHAR PRIMARY KEY NOT NULL, url VARCHAR NOT NULL, country VARCHAR NOT NULL, site_name VARCHAR NOT NULL, account_type VARCHAR, lang_code VARCHAR, lang_name VARCHAR)"),f.execute("CREATE TABLE IF NOT EXISTS friendly_names(uid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, contact_id INTEGER NOT NULL, msisdn VARCHAR, user_msisdn VARCHAR)"),f.execute("CREATE TABLE IF NOT EXISTS user_language(uid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, msisdn VARCHAR, lang_code VARCHAR, lang_name VARCHAR)");for(var T=f.execute("SELECT * FROM user_language");T.isValidRow();)Ti.API.info("msisdn: "+T.fieldByName("msisdn")+" lang: "+T.fieldByName("lang_code")),T.next();f.close();var v=Ti.UI.createLabel({text:"Forgot password",color:"teal",font:{fontSize:"20sp"},top:"82%"}),b=Ti.UI.createTextField({hintText:o,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,color:"#336699",top:"44%",width:"30%",height:"5%",autocapitalization:0,autocorrect:!1,value:p.valueData}),y=Ti.UI.createTextField({hintText:n,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,color:"#336699",top:"50%",width:"30%",height:"5%",passwordMask:!0,value:g.valueData}),w=Ti.UI.createView({backgroundImage:"images/common/checkbox.png",width:"4%",height:"3%",top:"68%",left:c}),C=Ti.UI.createLabel({text:s,top:"67%",left:l,height:"5%",font:{fontSize:"22sp"}}),x=Ti.UI.createImageView({image:"images/common/loginButton.png",top:"60%",width:"30%",height:"5%"}),_=Ti.UI.createImageView({image:"images/common/registerButton.png",top:"75%",width:"30%",height:"5%"});return a(),i.add(b),i.add(y),i.add(x),i.add(m),i.add(_),i.add(w),i.add(C),i.add(v),x.addEventListener("click",function(){h.openIndicator();var t=Ti.Database.open("local"),a=t.execute("SELECT lang_name, lang_code FROM user_language where msisdn = ?",b.getValue());if(a.isValidRow()){var r=a.fieldByName("lang_code");t.close(),Ti.API.info("saved lang: "+r)}else var r="";r.length>0?("au"==r&&(r="en"),e(""+b.value,r,""+y.value,1)):e(""+b.value,"en",""+y.value,1)}),_.addEventListener("click",function(){t()}),m.addEventListener("click",function(){b.blur(),y.blur()}),C.addEventListener("click",function(){"images/common/checkbox.png"==w.getBackgroundImage()?w.setBackgroundImage("images/common/checkbox-checked.png"):w.setBackgroundImage("images/common/checkbox.png")}),w.addEventListener("click",function(){"images/common/checkbox.png"==w.getBackgroundImage()?w.setBackgroundImage("images/common/checkbox-checked.png"):w.setBackgroundImage("images/common/checkbox.png")}),b.addEventListener("click",function(){b.blur(),y.blur(),b.keyboardType=Ti.UI.KEYBOARD_PHONE_PAD,b.focus()}),v.addEventListener("click",function(){var e=require("ui/common/forgotPassword");e.forgotPassword()}),i.addEventListener("swipe",function(e){"down"==e.direction?b.blur():"up"==e.direction&&b.focus()}),i}module.exports=login;