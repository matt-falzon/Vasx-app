function open(){function e(){l.setVisible(!0);for(var e=Ti.Database.open("local"),t=e.execute("SELECT * FROM friendly_names WHERE user_msisdn =?",Ti.App.msisdn);t.isValidRow();){var a=t.fieldByName("msisdn"),i=t.fieldByName("contact_id");Ti.API.info("Number: "+a+" contact id: "+i),t.next(),o.push(i)}Ti.API.info("----------");for(var n=0;o.length>n;n++)for(var c=0;u.data[0].rows.length>c;c++)o[n]==u.data[0].rows[c].id&&5>Ti.App.checks&&(Ti.API.info("MSISDN "+u.data[0].rows[c].msisdn+": Ticked"),u.data[0].rows[c].hasCheck=!0,Ti.App.checks++,c=u.data[0].rows.length-1);Ti.API.info("Total checks: "+Ti.App.checks),e.close(),s=0,r.add(h),h.add(u),l.setColor(Ti.App.backgroundColor),l.setIndicatorColor(Ti.App.backgroundColor),l.setWidth(0),l.setHeight(0),l.hide()}function t(){r.open()}function a(){r.close()}var r=Ti.UI.createWindow({backgroundColor:"pink",left:"15%"});Ti.include(Ti.Filesystem.resourcesDirectory+"/libs/commonFunctions.js"),theme("red"),r.backgroundColor=Ti.App.backgroundColor,Ti.API.info(Ti.App.msisdn);var i,o=[],n=[],s=1;i="iPhone OS"===Ti.Platform.name?Ti.UI.iPhone.ActivityIndicatorStyle.DARK:Ti.UI.ActivityIndicatorStyle.DARK;var l=Ti.UI.createActivityIndicator({color:"green",font:{fontFamily:"Helvetica Neue",fontSize:26,fontWeight:"bold"},message:"Loading...",style:i,top:10,left:10,height:"20%",width:"50%",visible:!1}),c=function(){n=getContacts()},d=function(){alert("This app requires access to your phone book")};Ti.Contacts.contactsAuthorization==Ti.Contacts.AUTHORIZATION_AUTHORIZED?c():Ti.Contacts.contactsAuthorization==Ti.Contacts.AUTHORIZATION_UNKNOWN?Ti.Contacts.requestAuthorization(function(e){e.success?c():d()}):d(),Ti.UI.createButton({title:"press me",left:10});var u=Ti.UI.createTableView({data:n,backgroundColor:Ti.App.foregroundColor,separatorColor:Ti.App.backgroundColor,editable:!1});r.addEventListener("focus",function(){l.setVisible(!0)}),u.addEventListener("click",function(e){e.index,e.section;var t=e.row;e.rowData;var a=Ti.Database.open("local");t.hasCheck===!0?(t.hasCheck=!1,Ti.App.checks--,Ti.API.info(Ti.App.checks),rows=a.execute("DELETE FROM friendly_names WHERE contact_id =?",e.rowData.id),Ti.API.info("DELETED contact ID: "+e.rowData.id+" msisdn: "+e.rowData.msisdn+" Your number is: "+Ti.App.msisdn)):5>Ti.App.checks?(t.hasCheck=!0,Ti.API.info(e.rowData.msisdn),Ti.App.checks++,Ti.API.info(Ti.App.checks),rows=a.execute("INSERT INTO friendly_names (contact_id, msisdn, user_msisdn) VALUES (?, ?, ?)",e.rowData.id,e.rowData.msisdn,Ti.App.msisdn),Ti.API.info("Inserted contact ID: "+e.rowData.id+" msisdn: "+e.rowData.msisdn+" Your number is: "+Ti.App.msisdn)):alert("You may only have up to 5 friends selected"),a.close()});var h=Ti.UI.createView({backgroundColor:Ti.App.foregroundColor,top:"3%",bottom:"3%",left:"3%",right:"3%",borderRadius:10});return r.add(l),swipeWindow(r),closeMenu(r),e(),r.openWin=t,r.close=a,r}exports.open=open;